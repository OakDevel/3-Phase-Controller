/* 
 * File:   ThreePhaseDriver.cpp
 * Author: Cameron
 * 
 * Created on December 17, 2014, 3:20 PM
 */

#include <avr/pgmspace.h>

#include "ThreePhaseDriver.h"
#include "Board.h"

void ThreePhaseDriver::init() {
 Board::DRV::AL.off();
 Board::DRV::BL.off();
 Board::DRV::CL.off();
 Board::DRV::AH.off();
 Board::DRV::BH.off();
 Board::DRV::CH.off();
 
 Board::DRV::AL.output();
 Board::DRV::BL.output();
 Board::DRV::CL.output();
 Board::DRV::AH.output();
 Board::DRV::BH.output();
 Board::DRV::CH.output();
}

static const u2 limitedSinTable[] PROGMEM = {
    0,   8,  17,  25,  34,  42,  50,  59,  67,  75,  84,  92, 100, 109, 117, 125,
  134, 142, 150, 159, 167, 175, 183, 192, 200, 208, 216, 224, 233, 241, 249, 257,
  265, 273, 281, 289, 297, 305, 313, 321, 329, 337, 345, 353, 361, 369, 376, 384,
  392, 400, 407, 415, 423, 430, 438, 445, 453, 460, 468, 475, 483, 490, 497, 505,
  512, 519, 526, 534, 541, 548, 555, 562, 569, 576, 583, 590, 596, 603, 610, 617,
  623, 630, 637, 643, 650, 656, 662, 669, 675, 681, 688, 694, 700, 706, 712, 718,
  724, 730, 736, 742, 747, 753, 759, 764, 770, 775, 781, 786, 792, 797, 802, 807,
  812, 817, 822, 827, 832, 837, 842, 847, 851, 856, 861, 865, 870, 874, 878, 883,
  887, 891, 895, 899, 903, 907, 911, 915, 918, 922, 926, 929, 933, 936, 940, 943,
  946, 949, 952, 955, 958, 961, 964, 967, 970, 972, 975, 977, 980, 982, 985, 987,
  989, 991, 993, 995, 997, 999,1001,1003,1004,1006,1007,1009,1010,1012,1013,1014,
 1015,1016,1017,1018,1019,1020,1021,1021,1022,1022,1023,1023,1023,1024,1024,1024,
 1024,1024,1024,1024,1023,1023,1023,1022,1022,1021,1021,1020,1019,1018,1017,1016,
 1015,1014,1013,1012,1010,1009,1007,1006,1004,1003,1001, 999, 997, 995, 993, 991,
  989, 987, 985, 982, 980, 977, 975, 972, 970, 967, 964, 961, 958, 955, 952, 949,
  946, 943, 940, 936, 933, 929, 926, 922, 918, 915, 911, 907, 903, 899, 895, 891,
};

u2 ThreePhaseDriver::getPhasePWM(const u1 phase) {
// return 1024 * SIN(PI * phase * 2/3/256);
 return pgm_read_word(&limitedSinTable[phase]);
}


